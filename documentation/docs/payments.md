---
id: payments
title: Payments
---

You can find a list of request body parameters and possible outcomes [here](https://api-reference.checkout.com/#tag/Payments).

export const Highlight = ({children, color}) => (
<span
style={{
      color: color,
      padding: '0.2rem',
    }}>
{children}
</span>
);

## Request a card payment with a <Highlight color="#25c2a0">card token</Highlight>

The card token is generated by front-end integration options such as [Frames](https://docs.checkout.com/docs/frames) or one of the [Mobile SDKs](https://docs.checkout.com/docs/sdks#section-mobile-sdk-libraries). Keep in mind that this token expires in 15 minutes and can only be used once.

```java
TokenSource tokenSource = new TokenSource("tok_ubfj2q76miwundwlk72vxt2i7q");

CustomerRequest customer = new CustomerRequest();
customer.setEmail("user@email.com");
customer.setName("James Bond");

PaymentRequest<TokenSource> paymentRequest =
  PaymentRequest.fromSource(tokenSource, Currency.USD, 1000); //cents
paymentRequest.setCustomer(customer);
paymentRequest.setReference("ORD-123");

// Optionally, pass arbitrary metadata. Checkout will pass that metadata to the `payment_captured` webhook if the payment succeeds.
HashMap metadata = new HashMap<String, Object>();
metadata.put("my_custom_key", "my_custom_value"); 
// .. other custom field you wish to receie in a webhook
paymentRequest.setMetadata(metadata);

// Optionally, a custom success and failure url can be passed (for cases where 3DS is invoked)
paymentRequest.setSuccessUrl("https://my-website.com/some-page/success");
paymentRequest.setFailureUrl("https://my-website.com/some-page/failure");


PaymentResponse response = api.paymentsClient().requestAsync(paymentRequest).get();
```

## Request a card payment with a <Highlight color="#25c2a0">full card details</Highlight>

:::warning

You need to have a high level of PCI Compliance (SAQ-D) to be able to send requests with full card details. Note that unless this payment option is enabled on your account by Checkout.com, the <Highlight color="#5A522C">request will fail</Highlight>. Contact you account manager to request access for this payment interaction.

:::

```java
CardSource cardSource = new CardSource("4242424242424242", 6, 2025);
cardSource.setCvv("100");

CustomerRequest customer = new CustomerRequest();
customer.setEmail("user@email.com");
customer.setName("James Bond");

PaymentRequest<CardSource> paymentRequest =
  PaymentRequest.fromSource(cardSource, Currency.USD, 1000); //cents
paymentRequest.setCustomer(customer);
paymentRequest.setReference("ORD-123");

PaymentResponse response = api.paymentsClient().requestAsync(paymentRequest).get();
```

## Request a card payment with a <Highlight color="#25c2a0">an existing card</Highlight>

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">source.id</Highlight>. This id does not expire, so it can be used to perform subsequent payments without needing the customer to enter the card details again.

```java
IdSource idSource = new IdSource("src_vg3tm54ndfbefotjlmgrrvbxli");

CustomerRequest customer = new CustomerRequest();
customer.setEmail("user@email.com");
customer.setName("James Bond");

PaymentRequest<IdSource> paymentRequest =
  PaymentRequest.fromSource(idSource, Currency.USD, 1000); //cents
paymentRequest.setCustomer(customer);
paymentRequest.setReference("ORD-456");

PaymentResponse response = api.paymentsClient().requestAsync(paymentRequest).get();
```

## Request a card payment with a <Highlight color="#25c2a0">an existing customer</Highlight>

After you perform at least one successful payment for a customer, Checkout.com will return a <Highlight color="#02b48f">customer.id</Highlight>. This id can be used perform payments without needing the customer to enter the card details again.

```java
CustomerSource customerSource =
  new CustomerSource("cus_6artgoevd77u7ojah2wled32sa");

PaymentRequest<CustomerSource> paymentRequest =
  PaymentRequest.fromSource(customerSource, Currency.USD, 1000); //cents
paymentRequest.setReference("ORD-456");

PaymentResponse response = api.paymentsClient().requestAsync(paymentRequest).get();
```

## Request a payment for a <Highlight color="#25c2a0">local payment method</Highlight>

The [API Reference](https://api-reference.checkout.com/#tag/Payments/paths/~1payments/post) contains a list of local payment options that you can use, as well as the other information required in the payment source (if required).

This is an example of a payment request for [Giropay](https://docs.checkout.com/payment-methods/bank-transfers/giropay):

```java
AlternativePaymentSource alternativePaymentSource =
  new AlternativePaymentSource("giropay");
alternativePaymentSource.put("bic", "TESTDETT421");
alternativePaymentSource.put("purpose", "CKO Giropay test");

PaymentRequest<RequestSource> paymentRequest =
  PaymentRequest.fromSource(alternativePaymentSource, Currency.EUR, 1000); //cents

PaymentResponse response = api.paymentsClient().requestAsync(paymentRequest).get();
```

This request is meant to return a redirection URL, so you can let the customer complete the transaction on the local payment method's website. Normally a successful response would look like this:

```json
{
  "id": "pay_d3ohhwwu3qderfjlzitknc26sq",
  "status": "Pending",
  "customer": {
    "id": "cus_hfgq4ctsnr6e3cfhq5ctwb5gtu"
  },
  "_links": {
    "self": {
      "href": "https://api.sandbox.checkout.com/payments/pay_d3ohhwwu3qderfjlzitknc26sq"
    },
    "redirect": {
      "href": "https://ftg-customer-integration.giropay.de/ftgbank/b/bankselection/219499703994809788;jsessionid=8ECFE1809F9BAB6635EC9D37D98A1CAE.sf-testapp01tom21?op=001"
    }
  }
}
```

You can access the redirection URL via the SDK like so:

```java
PaymentPending pendingPayment = response.getPending();
// Your redirect link
pendingPayment.getRedirectLink();
```

## Request a <Highlight color="#25c2a0">3D Secure payment</Highlight>

You have the ability to authenticate with 3DS in a payment request. The request body is similar to normal card payments, but with some additional parameters. [Read more about 3DS](https://docs.checkout.com/docs/3d-secure-payments)

```java
TokenSource tokenSource = new TokenSource("tok_ubfj2q76miwundwlk72vxt2i7q");

CustomerRequest customer = new CustomerRequest();
customer.setEmail("user@email.com");
customer.setName("James Bond");

PaymentRequest<TokenSource> paymentRequest =
  PaymentRequest.fromSource(tokenSource, Currency.USD, 1000); //cents
paymentRequest.setCustomer(customer);
paymentRequest.setReference("ORD-123");
paymentRequest.setThreeDS(ThreeDSRequest.from(true)); //3DS: enabled

PaymentResponse response = api.paymentsClient().requestAsync(paymentRequest).get();
```

Similarly to local payment options, 3D Secure payments will return a redirection URL. Here is an example of a 3DS response:

```json
{
  "id": "pay_hehfmlkpykeupofyxf7nbr6yyy",
  "status": "Pending",
  "customer": {
    "id": "cus_u4a4zosnrw7ehhzr7jipbkdzo4"
  },
  "3ds": {
    "downgraded": false,
    "enrolled": "Y"
  },
  "_links": {
    "self": {
      "href": "https://api.sandbox.checkout.com/payments/pay_hehfmlkpykeupofyxf7nbr6yyy"
    },
    "redirect": {
      "href": "https://sandbox.checkout.com/api2/v2/3ds/acs/sid_feixbit6us3utfedjulm6egnsu"
    }
  }
}
```

You can access the redirection URL via the SDK like so:

```java
PaymentPending pendingPayment = response.getPending();
// Your redirect link
pendingPayment.getRedirectLink();
```

## Handle card <Highlight color="#25c2a0">payment responses</Highlight>

Payment requests are influenced by risk rules so you can have situations where a card payment is requested without 3D Secure, but upgraded by a risk rule, resulting in a 3D Secure response. You are free to handle the response in any way you want, but bellow you have a good example for a starting point:

```js
try {
  PaymentResponse response = api.paymentsClient().requestAsync(...).get();

  if (response.isPending()) {
    // Local/3DS payment. Redirect the customer to payment.getPending().getRedirectLink()
  } else if (response.getPayment().isApproved() && !response.getPayment().getRisk().isFlagged()) {
    // The payment was successful and not flagged by any risk rule
  } else if (response.getPayment().isApproved() && response.getPayment().getRisk().isFlagged()) {
    /* The payment was successful but it was flagged by a risk rule;
       this means you need to manually decide if you want to capture it or void it */
  } else if (!response.getPayment().isApproved()) {
    // The payment was declined
  }
} catch (Exception e) {
  LOG.severe("Payment response could not be handled");
  throw e;
}
```

## Get payment details

```java
GetPaymentResponse payment = api.paymentsClient().getAsync("pay_je5hbbb4u3oe7k4u3lbwlu3zkq").get(); // or with session id sid_XXX
```

## Get payment actions

```java
List<PaymentAction> paymentActions = api.paymentsClient().getActionsAsync("pay_juevt3h5mcjulir2t5g3wfug6u").get();
```

## Capture a payment

```java
// Full capture
api.paymentsClient().captureAsync("pay_je5hbbb4u3oe7k4u3lbwlu3zkq").get();

// Or partial capture
CaptureRequest captureRequest = CaptureRequest.builder()
  .reference("your reference")
  .amount(100)
  .build();

api.paymentsClient().captureAsync("pay_je5hbbb4u3oe7k4u3lbwlu3zkq", captureRequest).get();
```

## Refund a payment

```java
// Full refund
api.paymentsClient().refundAsync("pay_je5hbbb4u3oe7k4u3lbwlu3zkq").get();

// Or partial refund
RefundRequest refundRequest = RefundRequest.builder()
  .reference("your reference")
  .amount(100)
  .build();

api.paymentsClient().refundAsync("pay_je5hbbb4u3oe7k4u3lbwlu3zkq", refundRequest).get();
```

## Void a payment

```java
api.paymentsClient().voidAsync("pay_je5hbbb4u3oe7k4u3lbwlu3zkq").get();
```
